<!doctype html>
<html lang="en">

<head>
    <title>Halaman Penambahan Produk Baru - Admin</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="description" content="HexaBit Bootstrap 4x Admin Template">
    <meta name="author" content="WrapTheme, www.thememakker.com">

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- VENDOR CSS -->
    <link rel="stylesheet" href="template_assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="template_assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="template_assets/vendor/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css">
    <!-- <link rel="stylesheet" href="template_assets/vendor/chartist/css/chartist.min.css"> -->
    <!-- <link rel="stylesheet" href="template_assets/vendor/chartist-plugin-tooltip/chartist-plugin-tooltip.css"> -->
    <link rel="stylesheet" href="template_assets/vendor/toastr/toastr.min.css">
    <!-- <link rel="stylesheet" href="template_assets/vendor/morrisjs/morris.css" /> -->

    <link rel="stylesheet" href="assets/dist/css/lightbox.min.css">

    <link rel="stylesheet" href="template_assets/vendor/sweetalert/sweetalert.css">

    <!-- MAIN CSS -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/color_skins.css">
    <style>
        /* put swal text on center */
        .swal-text {
            text-align: center;
        }
    </style>
</head>

<body class="theme-cyan">

    <!-- Page Loader -->
    <div class="page-loader-wrapper">
        <div class="loader">
            <div class="m-t-30"><img src="template_assets/images/icon-light.svg" width="48" height="48" alt="HexaBit">
            </div>
            <p>Loading...</p>
        </div>
    </div>
    <!-- Overlay For Sidebars -->
    <div class="overlay"></div>

    <div id="wrapper">

        <nav class="navbar navbar-fixed-top">
            <div class="container-fluid">

                <div class="navbar-left">
                    <div class="navbar-btn">
                        <a href="admin_index.html"><img src="template_assets/images/icon-light.svg" alt="HexaBit Logo"
                                class="img-fluid logo"></a>
                        <button type="button" class="btn-toggle-offcanvas"><i
                                class="lnr lnr-menu fa fa-bars"></i></button>
                    </div>
                    <a href="javascript:void(0);" class="icon-menu btn-toggle-fullwidth"><i
                            class="fa fa-arrow-left"></i></a>
                    <ul class="nav navbar-nav">
                        <li class="dropdown dropdown-animated scale-right">
                            <a href="javascript:void(0);" class="dropdown-toggle icon-menu" data-toggle="dropdown"><i
                                    class="icon-grid"></i></a>
                            <ul class="dropdown-menu menu-icon app_menu">
                                <li>
                                    <a class="#">
                                        <i class="icon-envelope"></i>
                                        <span>Halaman Penjualan</span>
                                    </a>
                                </li>
                                <li>
                                    <a class="#">
                                        <i class="icon-bubbles"></i>
                                        <span>Laporan </span>
                                    </a>
                                </li>

                            </ul>
                        </li>

                    </ul>
                </div>

                <div class="navbar-right">
                    <!-- <form id="navbar-search" class="navbar-form search-form">
                        <input value="" class="form-control" placeholder="Search here..." type="text">
                        <button type="button" class="btn btn-default"><i class="icon-magnifier"></i></button>
                    </form> -->

                    <div id="navbar-menu">
                        <ul class="nav navbar-nav">

                            <li><a href="page-login.html" class="icon-menu"><i class="icon-power"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>


        <div id="left-sidebar" class="sidebar">
            <div class="navbar-brand">
                <a href="admin_index.html"><img src="template_assets/images/icon-light.svg" alt="HexaBit Logo"
                        class="img-fluid logo"><span>Kicap Karan</span></a>
                <button type="button" class="btn-toggle-offcanvas btn btn-sm btn-default float-right"><i
                        class="lnr lnr-menu fa fa-chevron-circle-left"></i></button>
            </div>
            <div class="sidebar-scroll">
                <div class="user-account">
                    <div class="user_div">
                        <img src="template_assets/admin.png" class="user-photo" alt="User Profile Picture">
                    </div>
                    <div class="dropdown">
                        <span>Selamat Datang,</span>
                        <a href="javascript:void(0);" class="dropdown-toggle user-name"
                            data-toggle="dropdown"><strong>Admin</strong></a>
                        <ul class="dropdown-menu dropdown-menu-right account">
                            <!-- <li><a href="page-profile.html"><i class="icon-user"></i>My Profile</a></li>
                            <li><a href="app-inbox.html"><i class="icon-envelope-open"></i>Messages</a></li>
                            <li><a href="javascript:void(0);"><i class="icon-settings"></i>Settings</a></li>
                            <li class="divider"></li> -->
                            <li><a href="#" onclick="logout()"><i class="icon-power"></i>Logout</a></li>
                        </ul>
                    </div>
                </div>
                <nav id="left-sidebar-nav" class="sidebar-nav">
                    <ul id="main-menu" class="metismenu">
                        <li><a href="admin_index.html"><i class="icon-basket-loaded"></i><span>Halaman
                                    Penjualan</span></a></li>
                        <li class="active"><a href="penambahan_produk.html"><i class="fa fa-edit"></i><span>Produk Baru</span></a></li>
                        <li><a href="list_produk.html"><i class=" icon-list"></i><span>List Produk</span></a></li>
                        <li><a href="laporan.html"><i class="icon-book-open"></i><span>Log Laporan</span></a></li>




                    </ul>
                </nav>
            </div>
        </div>

        <div id="main-content">
            <div class="block-header">
                <div class="row clearfix">
                    <div class="col-md-6 col-sm-12">
                        <h2>Halaman Penambahan Produk Baru</h2>
                    </div>
                    <div class="col-md-6 col-sm-12 text-right">
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="admin_index.html"><i class="icon-home"></i></a></li>
                            <li class="breadcrumb-item active">Halaman Penambahan Produk Baru</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="container-fluid">
                <!-- SINI MAIN NYA -->

                <div class="row clearfix">
                    <div class="col-lg-3 col-md-1"></div>

                    <div class="col-lg-6 col-md-10">
                        <div class="card">
                            <div class="body">
                                <div class="form-group">
                                    <label>Foto Produk</label>
                                    <input type="file" class="form-control" id="foto"
                                        placeholder="Masukkan Kode Produk">
                                </div>
                                <div class="form-group">
                                    <label>Kode Produk</label>
                                    <input type="text" class="form-control" id="kode_barang"
                                        placeholder="Masukkan Kode Produk" maxlength="6">
                                </div>

                                <div class="form-group">
                                    <label>Nama Produk</label>
                                    <input type="text" class="form-control" id="nama"
                                        placeholder="Masukkan Nama Produk">
                                </div>

                                <div class="form-group">
                                    <label>Harga Produk <i>(Per Helai)</i></label>
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Rp.</span>
                                        </div>
                                        <input type="text" class="form-control"
                                            placeholder="Masukkan Harga Produk per Helai" id="harga_jual" maxlength="7">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Jumlah Stok</label>
                                    <input type="text" class="form-control" placeholder="Masukkan Jumlah Stok Produk"
                                        id="jumlah" maxlength="4" onkeypress="return isNumberKey(event)">
                                </div>

                                <div class="form-group">
                                    <label>Pembelian Stok</label>
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Rp.</span>
                                        </div>
                                        <input type="text" class="form-control"
                                            placeholder="Masukkan Harga Pembelian Stok" id="harga_pembelian_stok"
                                            maxlength="10">
                                    </div>
                                </div>

                                <div class="form-group text-center">
                                    <button class="btn btn-primary text-center" onclick="tambah_produk_baru()">Tambah
                                        Produk Baru</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-1"></div>
                </div>



            </div>
        </div>

    </div>


    <!-- Javascript -->
    <script src="assets/bundles/libscripts.bundle.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
    <script src="assets/bundles/vendorscripts.bundle.js"></script>

    <!-- <script src="assets/bundles/chartist.bundle.js"></script> -->
    <script src="template_assets/vendor/toastr/toastr.js"></script>
    <!--script src="assets/bundles/morrisscripts.bundle.js"></script-->
    <!-- Morris Plugin Js -->

    <script src="assets/bundles/mainscripts.bundle.js"></script>
    <script src="assets/js/index.js"></script>
    <script src="assets/dist/js/lightbox.min.js"></script>
    <script src="template_assets/vendor/sweetalert/sweetalert.js"></script>
    <script src="assets/block/jquery.blockUI.js"></script>
    <script src="main2.js"></script>
    <script src="main.js"></script>

    <script>
        document.getElementById("foto").onchange = function () {
            let foto_produk = document.getElementById('foto').files[0];
            check_file(foto_produk)
        }

        async function tambah_produk_baru() {
            //create let variable foto_produk = document.getElementById('foto_produk') files;
            let foto_produk = document.getElementById('foto').files[0];
            let kode_produk = document.getElementById('kode_barang').value;
            let nama_produk = document.getElementById('nama').value;
            let harga_produk = document.getElementById('harga_jual').value;
            let jumlah_stok = document.getElementById('jumlah').value;
            let pembelian_stok = document.getElementById('harga_pembelian_stok').value;

            //if foto_produk == null or foto_produk == undefined then toastr.error('Foto Produk Tidak Boleh Kosong') focus on foto_produk else if kode_produk == '' or kode_produk == undefined then toastr.error('Kode Produk Tidak Boleh Kosong') focus on kode_produk else if nama_produk == '' or nama_produk == undefined then toastr.error('Nama Produk Tidak Boleh Kosong') focus on nama_produk else if harga_produk == '' or harga_produk == undefined then toastr.error('Harga Produk Tidak Boleh Kosong') focus on harga_produk else if jumlah_stok == '' or jumlah_stok == undefined then toastr.error('Jumlah Stok Tidak Boleh Kosong') focus on jumlah_stok else if pembelian_stok == '' or pembelian_stok == undefined then toastr.error('Pembelian Stok Tidak Boleh Kosong') focus on pembelian_stok else console.log('ok')
            if (foto_produk == null || foto_produk == undefined) {
                toastr.error('Foto Produk Tidak Boleh Kosong')
                document.getElementById('foto').focus()
            } else if (kode_produk == '' || kode_produk == undefined) {
                toastr.error('Kode Produk Tidak Boleh Kosong')
                document.getElementById('kode_barang').focus()
            } else if (nama_produk == '' || nama_produk == undefined) {
                toastr.error('Nama Produk Tidak Boleh Kosong')
                document.getElementById('nama').focus()
            } else if (harga_produk == '' || harga_produk == undefined) {
                toastr.error('Harga Produk Tidak Boleh Kosong')
                document.getElementById('harga_jual').focus()
            } else if (jumlah_stok == '' || jumlah_stok == undefined) {
                toastr.error('Jumlah Stok Tidak Boleh Kosong')
                document.getElementById('jumlah').focus()
            } else if (pembelian_stok == '' || pembelian_stok == undefined) {
                toastr.error('Pembelian Stok Tidak Boleh Kosong')
                document.getElementById('harga_pembelian_stok').focus()
            } else {
                //create let variable data = json all data
                let data_all = {
                    foto: foto_produk.name,
                    kode_barang: kode_produk,
                    nama: nama_produk,
                    harga_jual: harga_produk,
                    jumlah: jumlah_stok,
                    pembelian_stok: pembelian_stok,
                    bertanggungjawab: localStorage.getItem('no_user')
                }

                //create swal "Yakin Ingin Menambahkan Produk Baru?" with button ok and cancel
                swal({
                    title: "",
                    text: "Yakin Ingin Menambahkan Produk Baru?",
                    icon: "info",
                    buttons: true,
                    dangerMode: false,
                }).then( async (willDelete) => {
                    if (willDelete) {
                        //create try catch
                        try {
                            // sedang_proses()
                            // create let variable data = new FormData()
                            let data = new FormData()
                            data.append('foto', foto_produk)
                            data.append('data', JSON.stringify(data_all))
                            //create fetch with headers basic auth and body
                            let response = await fetch('http://localhost/ilham/server/api/tambah_produk', {
                                method: 'POST',
                                headers: {
                                    // 'Content-Type': 'application/json',
                                    'Authorization': 'Basic ' + btoa('Kicap_karan:bb10c6d9f01ec0cb16726b59e36c2f73')
                                },
                                body: data
                            })


                            // if response status == 200 console.log('ok') else if response status == 400 console.log('gagal') 
                            if (response.status == 200) {
                                $.unblockUI();
                                console.log('ok')
                                //create let variable response = await response.json()
                                let response_json = await response.json()
                                console.log(response_json.stat)
                                //create swal with title "Sukses" and text "Produk Baru Berhasil Ditambahkan\n Sila Tekan Ok untuk ke halaman 'List Produk'" with ok button that redirect to list_produk.html and cancel button that close swal and do nothing
                                swal({
                                    title: "Sukses",
                                    text: "Produk Baru Berhasil Ditambahkan\n"+(response_json.stat == 'success') ? "Laporan Berhasil Terkirim Ke Server Online": "Laporan Gagal Terkirim Ke Server Online"+"\n Sila Tekan Ok untuk ke halaman 'List Produk'",
                                    icon: "success",
                                    buttons: {
                                        cancel: {
                                            text: "Tutup",
                                            visible: true,
                                            closeModal: true,
                                        },
                                        ok: {
                                            text: "Ok",
                                            closeModal: true,
                                            visible: true,
                                            value: true,
                                            className: "bg-success",
                                            closeModal: true,
                                            closeOnClick: true
                                        }
                                    }
                                }).then((value) => {
                                    if (value) {
                                        window.location.href = 'list_produk.html'
                                    }
                                })

                                //set all input to empty
                                document.getElementById('foto').value = null
                                document.getElementById('kode_barang').value = ''
                                document.getElementById('nama').value = ''
                                document.getElementById('harga_jual').value = ''
                                document.getElementById('jumlah').value = ''
                                document.getElementById('harga_pembelian_stok').value = ''

                            } else if (response.status == 400) {
                                $.unblockUI();
                                //create swal with title 'gagal' and text 'Kode Produk Sudah Ada' with timer 1500 and no ok button
                                swal({
                                    icon: 'error',
                                    title: 'Gagal',
                                    text: 'Kode Produk Sudah Ada',
                                    timer: 2000,
                                    button: false
                                })
                                //focus on kode_produk
                                document.getElementById('kode_barang').focus()
                            }

                        } catch (err) {
                            $.unblockUI();
                            //create swal with title 'Error' and text 'Terjadi Kesalahan \n Sila Refresh Halaman Dengan Button 'OK'' , ok button refresh page and cancel button close swal and do nothing
                            swal({
                                icon: 'error',
                                title: 'Error',
                                text: 'Terjadi Kesalahan \n Sila Refresh Halaman Dengan Button OK',
                                buttons: {
                                    cancel: {
                                        text: "Tutup",
                                        visible: true,
                                        closeModal: true,
                                    },
                                    ok: {
                                        text: "Ok",
                                        closeModal: true,
                                        visible: true,
                                        value: true,
                                        className: "bg-success",
                                        closeModal: true,
                                        closeOnClick: true
                                    }
                                }
                            }).then((value) => {
                                if (value) {
                                    window.location.href = 'list_produk.html'
                                }
                            })
                            console.log(err)
                        }


                    }
                });



            }
        }




    </script>
</body>

</html>